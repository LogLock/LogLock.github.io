<!doctype html5>
<html>
    <head>
        <meta charset="utf-8">

        <title>LogLock realtime status</title>

        <link href="../lib/lib.min.css" rel="stylesheet">
        
        <style>
            .nav-tabs {
                background-color: #4DB6AC;
            }
            .active {
                background-color: #009587;
            }
        </style>
        
    </head>
    <body>
        <div class="container">
            <div class="row">
                <div class="col-xs-12 text-center">
                    <img src="http://loglock.github.io/img/logos/log-lock-logo-green.png" width="256">
                </div>
            </div>
            <div class="row">
                <div class="col-lg-3 text-center">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            <h3 class="panel-title">Login attempts</h3>
                        </div>
                        <div class="panel-body">
                            <span class="updating-chart timeseries">5,3,9,6,5,9,7,3,5,2,5,3,9,6,5,9,7,5,3,9,6,5,9,7,3,5,2,5,3,9,6,5,9,7,3,5,2</span>
                        </div>
                    </div>
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            <h3 class="panel-title">Suspicious login attempts</h3>
                        </div>
                        <div class="panel-body">
                            <span class="updating-chart2 timeseries">1,3,2,1,2,2,3,2,1,2,3,1,2,3,1,1,1,1,2,3,1,2,3,2,1,2,3,2,4,5,2,4,1,1,2,3,2</span>
                        </div>
                    </div>
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            <h3 class="panel-title">Verified percentage</h3>
                        </div>
                        <div class="panel-body">
                            <h1 class="big">35%</h1> (avg +20% compared to yesterday)
                        </div>
                    </div>
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            <h3 class="panel-title">Accounts stolen by provider</h3>
                        </div>
                        <div class="panel-body">
                            <table class="table table-striped table-bordered">
                                <tr>    
                                    <th>Provider</th>
                                    <th>%</th>
                                </tr>
                                <tr>    
                                    <td>twitter</td>
                                    <td>20</td>
                                </tr>
                                <tr>    
                                    <td>CyberBank</td>
                                    <td>42</td>
                                </tr>
                                <tr>    
                                    <td>Tuenti</td>
                                    <td>83</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-9">
                    <ul class="nav nav-tabs" style="margin-bottom: 15px;">
                        <li class="active strong"><a href="#logins" data-toggle="tab">Logins attempts map</a></li>
                        <li><a href="#zones" data-toggle="tab">Security zones map</a></li>
                        <li><a href="#table" data-toggle="tab">Logins attempts table</a></li>
                    </ul>
                    <div id="myTabContent" class="tab-content">
                        <div class="tab-pane fade active in" id="logins">
                            <iframe width='100%' height='65%' frameborder='0'
                                    src='http://loglock.cartodb.com/viz/011dec34-7d80-11e4-8c6c-0e018d66dc29/embed_map'
                                    allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>
                        </div>
                        <div class="tab-pane fade" id="zones">
                            <iframe width='100%' height='65%' frameborder='0'
                                    src='http://loglock.cartodb.com/viz/100878ba-7d97-11e4-b4dd-0e4fddd5de28/embed_map'
                                    allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>
                        </div>
                        <div class="tab-pane fade" id="table">
                            <div id="contentTable"></div>
                        </div>
                    </div>
                </div>
            </div>
                
        </div>
        
        <script src="http://loglock.github.io/lib/lib.min.js"></script>
        <script src="http://benpickles.github.io/peity/jquery.peity.js"></script>
        <script src="https://rawgit.com/jashkenas/underscore/master/underscore.js"></script>

        <script>
            var chart_update = function() {
                
                var updatingChart1 = $(".updating-chart").peity("line", {
                    width: 200, 
                    height: 60});
                
                var updatingChart2 = $(".updating-chart2").peity("line", {
                    width: 200, 
                    height: 30});

                setInterval(function() {
                    var random1 = Math.round(Math.random() * 10);
                    var values1 = updatingChart1.text().split(",");
                    values1.shift();
                    values1.push(random1);

                    updatingChart1
                        .text(values1.join(","))
                        .change();

                    var random2 = Math.round(Math.random() * 3);
                    var values2 = updatingChart2.text().split(",");
                    values2.shift();
                    values2.push(random2);

                    updatingChart2
                        .text(values2.join(","))
                        .change();


                }, 500);
            }

            var stats_update = function(){
                setInterval(function(){
                    $('.big').each(function(){
                        var el = $(this);
                        var new_value = parseInt(el.html().replace('%', ''))
                        el.html(new_value+Math.round(Math.random() * 3 - Math.random() * 3)+'%');
                    });
                }, 1500);
            }
            
            var hardCodeTable = function() {
                
                var rows = [{"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "37.134.144.216", "os": "Linux", "result": -1, "browser": "Firefox"}, {"ip": "37.134.144.216", "os": "Linux", "result": -1, "browser": "Chrome"}, {"ip": "37.134.144.216", "os": "Linux", "result": -1, "browser": "Chrome"}, {"ip": "37.134.144.216", "os": "Linux", "result": -1, "browser": "Chrome"}, {"ip": "37.134.144.216", "os": "Linux", "result": -1, "browser": "Firefox"}, {"ip": "80.31.252.12", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "80.31.252.12", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "80.31.252.12", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "80.31.252.12", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "80.31.252.12", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "127.0.0.1", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "62.37.219.254", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "194.183.97.78", "os": "Android", "result": -1, "browser": "Chrome"}, {"ip": "127.0.0.1", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "37.134.144.216", "os": "None", "result": -1, "browser": "None"}, {"ip": "37.134.144.216", "os": "None", "result": -1, "browser": "None"}, {"ip": "37.134.144.216", "os": "None", "result": -1, "browser": "None"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "127.0.0.1", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "37.134.144.216", "os": "None", "result": -1, "browser": "None"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "37.134.144.216", "os": "None", "result": -1, "browser": "None"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "37.134.144.216", "os": "None", "result": -1, "browser": "None"}, {"ip": "37.134.144.216", "os": "None", "result": -1, "browser": "None"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": 1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "127.0.0.1", "os": "Mac OS X", "result": 0, "browser": "Chrome"}, {"ip": "127.0.0.1", "os": "Mac OS X", "result": 0, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": 0, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": 0, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": 0, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": 0, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": 0, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": 0, "browser": "Chrome"}, {"ip": "37.134.144.216", "os": "Linux", "result": 0, "browser": "Chrome"}, {"ip": "80.31.252.12", "os": "iOS", "result": 0, "browser": "Safari"}, {"ip": "80.31.252.12", "os": "iOS", "result": 0, "browser": "Safari"}, {"ip": "80.31.252.12", "os": "iOS", "result": 0, "browser": "Safari"}, {"ip": "80.31.252.12", "os": "iOS", "result": 0, "browser": "Safari"}, {"ip": "80.31.252.12", "os": "iOS", "result": 0, "browser": "Safari"}, {"ip": "47.61.247.27", "os": "Android", "result": 0, "browser": "Chrome"}, {"ip": "80.31.252.12", "os": "iOS", "result": 0, "browser": "Safari"}, {"ip": "47.61.247.27", "os": "Android", "result": 0, "browser": "Chrome"}, {"ip": "62.37.219.254", "os": "Mac OS X", "result": 0, "browser": "Chrome"}, {"ip": "80.31.252.12", "os": "iOS", "result": 0, "browser": "Safari"}, {"ip": "37.134.144.216", "os": "Linux", "result": 0, "browser": "Chrome"}, {"ip": "37.134.144.216", "os": "Linux", "result": 0, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -2, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -2, "browser": "Chrome"}, {"ip": "62.37.219.254", "os": "Mac OS X", "result": -2, "browser": "Chrome"}, {"ip": "62.37.219.254", "os": "Mac OS X", "result": -2, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -2, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": 1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -2, "browser": "Chrome"}, {"ip": "127.0.0.1", "os": "Mac OS X", "result": -1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": 1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": 1, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -2, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -2, "browser": "Chrome"}, {"ip": "47.61.247.27", "os": "Mac OS X", "result": -1, "browser": "Chrome"}];
                
                drawTable(rows);
            }
            
            var getTable = function() {
                
                var data = {};
                
                // get data from server
                util_ajaxGet('/hashtags', data, function(json) {

                    if(!json || json.error) {

                        console.log('ERROR retrieving data table', json.error);

                    } else {

                        var rows = json;

                        console.log(rows.length+' rows retrieved');
                        
                        drawTable(rows);
                    }
                });

            }
            
            var drawTable = function(rows) {
                
                var html = '<table class="table table-striped table-bordered">';
                html += '<tr>';
                    html += '<th>IP</th>';
                    html += '<th>OS</th>';
                    html += '<th>BROWSER</th>';
                    html += '<th>STATUS</th>';
                    html += '<th>CODE</th>';
                html += '</tr>';
                
                for (var i = 0; i < rows.length; i++) {
                    
                    var result = rows[i].result;
                    var text = "ok"
                    
                    switch (result)
                    {
                       case -2: 
                           text = 'need geo';
                           html += '<tr class="info">';
                           break;
                       case -1: 
                           text = 'denied';
                           html += '<tr class="danger">';
                           break;
                       case 0: 
                           text = 'need code';
                           html += '<tr class="warning">';
                           break;
                       default:
                           html += '<tr class="success">';
                           break;
                    }
                    
                    html += '<td>'+rows[i].ip+'</td>';
                    html += '<td>'+rows[i].os+'</td>';
                    html += '<td>'+rows[i].browser+'</td>';
                    html += '<td>'+text+'</td>';
                    html += '<td>'+result+'</td>';
                    html += '</tr>';
                }
                
                html += '</table>';
                
                $('#contentTable').append(html);
            }

            $(document).on('ready', function(){
                
                chart_update();
                stats_update();
                //getTable();
                hardCodeTable();
                
                $.material.init();
            });
            
        </script>
            
    </body>
</head>
